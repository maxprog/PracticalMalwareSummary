# 3 Basic dynamic analysis

*Dynamic analysis* = examination of a program performed during (and after) its execution. This phase is usually considered after having performed static analysis.

Dynamic analysis is particularly useful in case the static analysis has reached a dead end, for instance in cases in which of obfuscation or packing are being used.

The advantage of dynamic analysis is that it lets the analyst observe the malware's true functionalities; indeed, finding the name of a function in an executable does not mean that the function will be called.

Limitations:
- potentially expose the system at risks
- not all code paths may execute
- may be detected

## Main techniques

### Sandboxes

Sandbox = security mechanism that allows to run untrusted programs in a safe environment. These environments may include simulated network services to effectively test the program's functionalities.
**NOTE**: do not upload sensitive documents in public sandboxes.

Many sandboxes will analyze the executables for free and provide a report of the findings. Here are the typical sections of one of these reports:

- Static analysis information: what was discussed in Chapter 1
- File activity
- Created Mutexes
- Registry activity
- Network activity

Some drawbacks of using sandboxes are:
- execution of the malware may require a setup that is not implemented in the sandbox (command-line options, registry keys...)
- not all the events may be recorded; some malware waits for a 'trigger' to actually execute malicious code, while usually sandbox observe the program for a limited amount of time
- malwares may detect that they are running in a sandbox and do not execute the malicious code

### Running malware

For DLLs: `rundll32.exe DLLname, Export arguments`. The *Export* value must be a function name or ordinal (prepend the number with '#') from the exported function table in the DLL. Example:

```
rundll32.exe xyzzy.dll, #5
```

In most cases, the code is placed in `DLLMain` (called from the DLL entry point), thus it is enough to force the DLL to load using `roundll32.exe`. Another solution would be to change the PE header and force Windows to load the DLL as an exe.
